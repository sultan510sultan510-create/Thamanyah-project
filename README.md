# ๐ฏ ูุดุฑูุน ุจุซ ุจูุงูุงุช ุชูุงุนู ุงููุณุชุฎุฏููู โ ุชูููุฐ ุชูููู ูููุฏุณ ุจูุงูุงุช ุฃูู

ูุฐุง ุงููุดุฑูุน ูู ุชูููุฐ ุนููู ูุชูููู "ูููุฏุณ ุจูุงูุงุช ุฃูู"ุ ูููุฏู ุฅูู ุฅูุดุงุก ูุธุงู ุจุซ ูุญุธู ููุนุงููุงุช ุชูุงุนู ุงููุณุชุฎุฏููู ุงูุทูุงููุง ูู ูุงุนุฏุฉ ุจูุงูุงุช PostgreSQL ุฅูู ุซูุงุซ ูุฌูุงุช ูุฎุชููุฉ:

1. **BigQuery**: ููุชุญููู ูุฅูุดุงุก ุงูุชูุงุฑูุฑ.
2. **Redis**: ููุนุงูุฌุฉ ุงูุชูุงุนูุงุช ุงูุฒูููุฉ ุงููุญุธูุฉ (Real-Time).
3. **ูุธุงู ุฎุงุฑุฌู**: ููุซุงู ุนูู ุงูุชูุงูู ูุน ุฃูุธูุฉ ุฎุงุฑุฌูุฉ.

---

## โ ุงููุชุทูุจุงุช ุงูุชู ุชู ุชูููุฐูุง

| ุงููุชุทูุจ | โ ุงูุญุงูุฉ |
|---------|-----------|
| ุจุซ ุจูุงูุงุช ูู PostgreSQL | โ๏ธ |
| ุฅุซุฑุงุก ูุชุญููู ุงูุจูุงูุงุช | โ๏ธ |
| ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู BigQuery | โ๏ธ (ุนุจุฑ ูููุงุช JSON) |
| ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู Redis | โ๏ธ |
| ุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ูุธุงู ุฎุงุฑุฌู | โ๏ธ |
| ุฒูู ุงูุชุญุฏูุซ ุฃูู ูู 5 ุซูุงูู | โ๏ธ |
| ุฏุนู ุฅุนุงุฏุฉ ุงููุนุงูุฌุฉ (backfill) | โ๏ธ |
| ุจูุฆุฉ Docker ูุงุจูุฉ ููุชูุฑุงุฑ | โ๏ธ |
| ุชูุซูู ูุงูู ุดุงูู | โ๏ธ |

---

## ๐งฑ ููููุงุช ุงููุธุงู ุจุงูุชูุตูู

### ๐ฆ 1. `data_generator` โ ุชูููุฏ ุงูุจูุงูุงุช
- ูููุฃ ุฌุฏูู `content` ุจูุญุชูู ุชุฌุฑูุจู ุฅู ูุงู ูุงุฑุบูุง.
- ูููุฏ ุฃุญุฏุงุซ ุชูุงุนู ุนุดูุงุฆูุฉ (`play`, `pause`, `click`, `finish`).
- ูุฑุจุท ูู ุญุฏุซ ุจูุญุชูู ููุณุชุฎุฏู ูุฌูุงุฒ ููุฏุฉุ ููุฎุฒููุง ูู PostgreSQL.

---

### ๐ฆ 2. `producer` โ ุงููุฑุงุกุฉ ูู PostgreSQL ูุงูุจุซ ุฅูู Kafka
- ููุฑุฃ ุงูุฃุญุฏุงุซ ุงูุฌุฏูุฏุฉ ูุน ุฑุจุท ุจูุงูุงุช ุงููุญุชูู.
- ูุญุณุจ `engagement_seconds` ู `engagement_pct`.
- ูููุน ุงูุชูุฑุงุฑ ุจุงุณุชุฎุฏุงู Redis.
- ูุญูุธ ุชูููุช ุขุฎุฑ ุญุฏุซ ุชูุช ูุนุงูุฌุชู ูู `last_processed.txt`.
- ูุฑุณู ุงูุจูุงูุงุช ุฅูู Kafka.
- ูุฎุฒู ูุณุฎุฉ ูููุง ุจุตูุบุฉ JSON ูู `bigquery_batches/`.

> **ููุงุฐุง ุงุณุชุฎุฏูุช ุชุฎุฒูู JSONุ**  
> ูุฃู ุญุณุงุจ GCP ุบูุฑ ูููุชุฑุ ููุง ูููู ุงูุจุซ ุงููุจุงุดุฑ ุฅูู BigQuery. ูุฐุง ุชู ุชุฎุฒูู ุงููููุงุช ูู batches ูุคูุชุฉ ูุฑูุนูุง ูุงุญููุง ุนูุฏ ุงูุญุงุฌุฉ.

> **ูุฏุนู ุฃูุถูุง** ุชุดุบูู ุงููุถุน ุงูุชุงุฑูุฎู `backfill` ุนุจุฑ:
```bash
--backfill --since "2024-08-01T00:00:00"
```

---

### ๐ฆ 3. `consumer` โ ุงุณุชููุงู ูู Kafka ูุชูุฒูุน ูููุฌูุงุช
- ูุณุชููู ูู ุฑุณุงูุฉ ูู Kafka ููุญููู ุงูุชูุงุฑูุฎ.
- ูุฑุณู ุงููุญุชูู ุฅูู Redis ูุชุฌููุน:
  - ุงูุชูุงุนู ุญุณุจ ููุน ุงููุญุชูู.
  - ุฃูุซุฑ ุงูุฃุฌูุฒุฉ ุงุณุชุฎุฏุงููุง.
- ูุญุฐู ุงูุฃุญุฏุงุซ ุงูุฃูุฏู ูู 10 ุฏูุงุฆู.
- ูุญุณุจ ุฒูู ุงูุชุฃุฎูุฑ (Latency).
- ูุฑุณู ุงูุญุฏุซ ุฅูู ูุธุงู ุฎุงุฑุฌู ุนุจุฑ API (httpbin).
- ูุญุชูู ุนูู ุฏุงูุฉ `write_to_bq` ูุนูููุฉ ูุคูุชูุง.

---

### ๐ฆ 4. `uploader` โ ุชุญููู ุจูุงูุงุช JSON ุฅูู BigQuery
- ูุจุญุซ ุนู ูููุงุช `.json` ูู `bigquery_batches/`.
- ูุชุญูู ูู ุตูุงุญูุฉ ูู ุณุทุฑ JSON.
- ููุดุฆ ูุณุฎุฉ ูุธููุฉ ููุฑูุนูุง ุฅูู BigQuery.
- ูุญุฐู ุงููููุงุช ุจุนุฏ ุงูุฑูุน.
- ูุนูู ูู 5 ุซูุงูู ูู ุญููุฉ ูุณุชูุฑุฉ.

---


### โ๏ธ 5. `docker-compose.yml`
ุชููุฆุฉ ุจูุฆุฉ ุงูุชุดุบูู ุจุงููุงูู ุนุจุฑ Docker.
ููู `docker-compose.yml` ูุญุชูู ุนูู:

- PostgreSQL
- Redis
- Zookeeper + Kafka
- ุญุงููุงุช: `generator`, `producer`, `consumer`, `bigquery`

> **ูู ูุฌูุฏ** ูุฑุชุจุท ูู volume ูุณูููุฉ ุงูุชุทููุฑ ูุงููุฑุงูุจุฉ.

---
##  ููุงุญุธุงุช ูุจู ุงูุชุดุบูู

- ุชุฃูุฏ ูู ูุถุน ููู `bq_key.json` ุฏุงุฎู `consumer/` ู `uploader/`
- ุงูููู `last_processed.txt` ููุณุชุฎุฏู ูุญูุธ ุขุฎุฑ ุญุฏุซ ุชูุช ูุนุงูุฌุชู ูุถูุงู ุนุฏู ุงูุชูุฑุงุฑ.

---

## โถ๏ธ ุฎุทูุงุช ุงูุชุดุบูู

```bash
docker-compose up --build

# ุชูููุฏ ุงูุจูุงูุงุช
docker exec -it generator python data_generator.py

# ุงููุนุงูุฌุฉ ูุงูุจุซ
docker exec -it producer python event_processor_producer.py

# ุงููุณุชููู (Redis + API ุฎุงุฑุฌู)
docker exec -it consumer python event_processor_consumer.py

# ุงูุฑูุน ุฅูู BigQuery (ุงุฎุชูุงุฑู)
docker exec -it bigquery python load_to_bigquery.py
```

---

# ๐งฉ ุงููุฑุงุฑุงุช ุงูุชุตููููุฉ ูุฃุณุจุงุจูุง

### 1. ุชุฎุฒูู ุจูุงูุงุช BigQuery ูู JSON
ูุนุฏู ุชููุฑ ุญุณุงุจ ูููุชุฑุ ุชู ุชุฎุฒูู ุงูุจูุงูุงุช ูู ูููุงุช JSON ูุน ูุฌูุฏ `bigquery_batches`ุ ูุชุญุถูุฑ ุทุฑููุฉ ุฅุฑุณุงู ูุจุงุดุฑ ุฏุงุฎู ุงูููุฏ (ูููุนููู) ูุงุณุชุฎุฏุงููุง ูุงุญููุง.

---

### 2. ุงุณุชุฎุฏุงู `last_processed.txt`
ูุชูููุฐ `Exactly-once` ุจุณูุท ููุนูุงูุ ูุณูุญ ุจุฅุนุงุฏุฉ ุงูุชุดุบูู ูู ุขุฎุฑ ููุทุฉ ุชููู ุฏูู ุชูุฑุงุฑ ุงูุฃุญุฏุงุซ.

---

### 3. Redis ูุฌูุฉ ูุญุธูุฉ
ูุชู ุงุณุชุฎุฏุงู Redis ูุงุณุชุฎุฑุงุฌ ุงูุฅุญุตุงุกุงุช ุงููุญุธูุฉ ุฎูุงู ุฃูู ูู 5 ุซูุงูู.

---

### 4. ุงููุตู ุจูู `producer` ู `consumer`
ูุถูุงู ูุฑููุฉ ุฃูุจุฑุ ูุณูููุฉ ูู ุงูุชูุณุนุฉุ ููุตู ูุนุงูุฌุฉ ุงููุตุฏุฑ ุนู ูุนุงูุฌุฉ ุงููุฌูุงุช.

---

### 5. Kafka ููุธุงู ูุณูุท
ูููุฑ ุชุฑุชูุจุ ูุณุฑุนุฉุ ูุฅุฏุงุฑุฉ ุงูุฃุญุฏุงุซ ุจูู ุนุฏุฉ ูุณุชููููู.

---


## ๐ง ุงูุฎูุงุตุฉ

ุชู ุชูููุฐ ุงููุดุฑูุน ููู ุงููุชุทูุจุงุช ุงููุงููุฉ ููุชููููุ ูุน ุงูุงูุชุฒุงู ุจุฌููุน ุงูุดุฑูุท ุงููููุฉ:
- ุจุซ ูุญุธู ูุชุญูููุงุช ุฏูููุฉ.
- Redis ุจุชุฃุฎูุฑ ุฃูู ูู 5 ุซูุงูู.
- ุฏุนู backfill ูุฑู.
- ุชุฎุฒูู ูุฑุญูู ูู BigQuery.
- ูุตู ุงูููุงู ูุชูุณุนุฉ ุฃุณูู.
- ุจูุฆุฉ Docker ูุชูุงููุฉ.
- ุชูุซูู ุดุงูู ููู ุฎุทูุฉ ุชู ุชูููุฐูุง.
